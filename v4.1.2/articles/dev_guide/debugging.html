<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Debugging with dnSpy </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Debugging with dnSpy ">
    <meta name="generator" content="docfx 2.47.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    <meta property="docfx:urlPrefix" content="/bepinex_docs/">
    
    
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
              <div class="version-selector" style="display: none;">
                <span>Version:</span>
                <form>
                    <select class="versions-dropdown"></select>
                </form>
              </div>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container-fluid body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-9">
            <article class="content wrap" id="_content" data-uid="">
<h2 id="debugging-with-dnspy">Debugging with dnSpy</h2>

<p>Due to the in-memory patching introduced in BepInEx 4.0, it is not possible to use dnSpy to debug plugins with the base installation of BepInEx. Instead, the developers must use the modified <code>BepInEx.Patcher.exe</code>.</p>
<blockquote>
<p><strong>NOTE</strong><br>
The dnSpy-compatible BepInEx patcher does not support in-memory preloader patchers!<br>
Thus, you can only debug normal plug-ins.</p>
</blockquote>
<h3 id="setting-up-bepinex">Setting up BepInEx</h3>
<p>The permanent assembly patcher for BepInEx is provided as a separate download in the <a href="http://bepisbuilds.dyn.mk/bepinex_be">Bleeding Edge</a> builds. In order to use the dnSpy debugger functionality, you must apply the hardpatch to the game.
To set up BepInEx to work with dnSpy debugger, do the following:</p>
<ol>
<li><p>Download the base BepInEx build and the BepInEx patcher (from <a href="https://github.com/BepInEx/BepInEx/releases">releases</a>, <a href="http://bepisbuilds.dyn.mk/bepinex_be">Bleeding Edge builds</a>) or  <a class="xref" href="building.html">build them yourself</a>.</p>
</li>
<li><p>Install base BepInEx as per the <a class="xref" href="../user_guide/installation.html">installation guide</a>.</p>
</li>
<li><p>Place <code>BepInEx.Patcher.exe</code> into the game's root folder</p>
</li>
<li><p>Run <code>BepInEx.Patcher.exe</code> (or <code>mono BepInEx.Patcher.exe</code> if you are on Linux/macOS). This will patch game's <code>UnityEngine.dll</code> and place <code>BepInEx.Bootstrap.dll</code> into the game's <code>Managed</code> folder.</p>
</li>
<li><p>Modify <code>doorstop_config.ini</code> as follows:</p>
<pre><code class="lang-ini">enabled=false
</code></pre>
</li>
</ol>
<h3 id="setting-up-dnspy">Setting up dnSpy</h3>
<ol>
<li>Download the latest version of <a href="https://github.com/0xd4d/dnSpy/releases">dnSpy</a> and an appropritate version of Unity-debugging package</li>
<li>From the downloaded Unity-debugging package, pick <code>mono.dll</code> that corresponds to the version of the game you want to debug and replace the game's original <code>mono.dll</code> with it</li>
<li>Open dnSpy and open the plugin DLL (from <code>BepInEx</code> folder) you want to debug. Additionally, open game's own assemblies to debug (from <code>Managed</code> folder)</li>
<li>Set up appropriate breakpoints</li>
<li>Open <code>Debug &gt; Start Debugging</code> dialogue</li>
<li>Select <code>Unity</code> as the Debug engine, select the game's EXE (not the launcher) and press OK to start debugging
If everything worked correctly, dnSpy will not time out in 30 seconds (or in whatever timeout time you configured) and will break on any breakpoint you set.</li>
</ol>
<h3 id="reverting-back-to-original-bepinex">Reverting back to original BepInEx</h3>
<p>When you don't want to debug anymore, you can revert back to the original game installation as follows:</p>
<ol>
<li>Restore <code>mono.dll</code> to the original version</li>
<li>From every <code>Managed</code> folder found in the game's root (or its subfolders), remove <code>BepInEx.Bootstrap.dll</code> and restore <code>UnityEngine.dll.bak</code></li>
</ol>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/BepInEx/bepinex_docs/blob/4360791da14d337f65c1a2203997861adf684b20/articles/dev_guide/debugging.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
